@page "/profile"
@using BusinessLogic
@inject MemoryDatabase MemoryDatabase
@inject ToastService ToastService
@inject NavigationManager NavigationManager

<PageTitle>Profile</PageTitle>

<h1>Perfil</h1>

<div class="profile-header">
	<img src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" width="10%" />
	<div class="profile-info">
		<h2>@MemoryDatabase.currentUser.Name @MemoryDatabase.currentUser.LastName</h2>
		<p>@MemoryDatabase.currentUser.Email</p>
	</div>
</div>
<div class="profile-details">

	<h3>Información del perfil</h3>

	<form @onsubmit="UpdateUser">
		<div class="profile-field">
			<label for="name">Nombre</label><br />
			<input type="text" id="name" @bind-value="name" />
		</div>

		<div class="profile-field">
			<label for="last-name">Apellido</label><br />
			<input type="text" id="last-name" @bind-value="lastName" />
		</div>

		<div class="profile-field">
			<label for="address">Direccion</label><br />
			<input type="text" id="address" @bind-value="address" />
		</div>

		<div class="profile-field">
			<label for="password">Contraseña</label><br />
			<input type="password" id="password" @bind-value="password" />
		</div>

		<button type="submit" class="btn btn-primary">Guardar detalles</button>
	</form>
</div>

<style>
	.profile-header {
		background-color: #fff;
		margin-top: 1rem;
		margin-bottom: 1rem;
	}

	.profile-info {
		margin-bottom: 1rem;
		margin-top: 1rem;
	}

		.profile-info h2 {
			font-size: 1.5rem;
			font-weight: bold;
		}

		.profile-info p {
			font-size: 1rem;
		}

	.profile-details {
		margin-top: 1rem;
		margin-bottom: 1rem;
	}

	.profile-field {
		margin-bottom: 1rem;
	}

		.profile-field label {
			font-weight: bold;
		}

		.profile-field input {
			width: 50%;
		}

	.btn {
		width: 50%;
	}
</style>

@code {
	private String name;
	private String email;
	private String lastName;
	private String address;
	private String password;

	private UserService _userService;

	protected override void OnInitialized()
	{
		if (MemoryDatabase.isLoggedIn)
		{
			name = MemoryDatabase.currentUser.Name;
			email = MemoryDatabase.currentUser.Email;
			lastName = MemoryDatabase.currentUser.LastName;
			address = MemoryDatabase.currentUser.Address;
			password = MemoryDatabase.currentUser.Password;
			_userService = new UserService(MemoryDatabase);
		}

	}

	public void UpdateUser()
	{
		try
		{
			_userService.UpdateUser(name, email, lastName, address, password);
			NavigationManager.NavigateTo("/");
		}
		catch
		{
			
		}
	}
}